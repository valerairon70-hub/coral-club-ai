<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Äî –¢—Ä–µ–∫–µ—Ä –∑–¥–æ—Ä–æ–≤—å—è</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #1a1a1a;
      color: #f0f0f0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –ø–∞—Ä–æ–ª—è ‚îÄ‚îÄ */
    #password-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .password-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    .password-card .logo {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .password-card h1 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: #f0f0f0;
    }

    .password-card .subtitle {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 2rem;
    }

    .password-card input[type="password"] {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: #f0f0f0;
      font-size: 1rem;
      margin-bottom: 0.75rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .password-card input[type="password"]:focus {
      border-color: #ff6b35;
    }

    .password-card .btn-login {
      width: 100%;
      background: #ff6b35;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .password-card .btn-login:hover { background: #e85d2a; }

    .error-msg {
      color: #ff5555;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      min-height: 1.2em;
    }

    /* ‚îÄ‚îÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚îÄ‚îÄ */
    #app { display: none; }

    header {
      background: #242424;
      border-bottom: 1px solid #333;
      padding: 1rem 0;
    }

    header .container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    header .header-icon { font-size: 1.5rem; }

    header h1 {
      font-size: 1.1rem;
      font-weight: 700;
      color: #f0f0f0;
    }

    header .tagline {
      font-size: 0.75rem;
      color: #888;
    }

    header .logout {
      margin-left: auto;
      background: none;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0.3rem 0.75rem;
      color: #888;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    header .logout:hover { border-color: #ff6b35; color: #ff6b35; }

    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    main { padding: 2rem 0; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start;
    }

    /* ‚îÄ‚îÄ –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ ‚îÄ‚îÄ */
    .input-panel {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 1.5rem;
    }

    .input-panel h2 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 1.25rem;
      color: #f0f0f0;
    }

    /* –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
    .upload-zone {
      border: 2px dashed #444;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1.25rem;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .upload-zone:hover, .upload-zone.drag-over {
      border-color: #ff6b35;
      background: rgba(255, 107, 53, 0.05);
    }

    .upload-zone .upload-icon { font-size: 2rem; margin-bottom: 0.5rem; }

    .upload-zone .upload-text {
      font-size: 0.9rem;
      color: #bbb;
      margin-bottom: 0.25rem;
    }

    .upload-zone .upload-hint {
      font-size: 0.75rem;
      color: #666;
    }

    .upload-zone img#preview {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      object-fit: contain;
    }

    .upload-zone input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .upload-zone .change-photo {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.3rem 0.6rem;
      font-size: 0.75rem;
      cursor: pointer;
      z-index: 2;
    }

    /* –ñ–∞–ª–æ–±—ã */
    .complaints-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #bbb;
      margin-bottom: 0.75rem;
    }

    .complaint-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .complaint-num {
      width: 24px;
      height: 24px;
      background: #333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: #ff6b35;
      flex-shrink: 0;
    }

    .complaint-row input {
      flex: 1;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 0.6rem 0.75rem;
      color: #f0f0f0;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .complaint-row input:focus { border-color: #ff6b35; }
    .complaint-row input::placeholder { color: #555; }

    /* –ö–Ω–æ–ø–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ */
    .btn-analyze {
      width: 100%;
      background: #ff6b35;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.85rem;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 1.25rem;
      transition: background 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-analyze:hover:not(:disabled) { background: #e85d2a; }
    .btn-analyze:active:not(:disabled) { transform: scale(0.98); }
    .btn-analyze:disabled { background: #555; cursor: not-allowed; }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚îÄ‚îÄ */
    .results-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .result-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      overflow: hidden;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

    .result-card-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid #333;
      font-weight: 700;
      font-size: 0.9rem;
    }

    .card-systems .result-card-header { border-left: 3px solid #4a9eff; }
    .card-chain   .result-card-header { border-left: 3px solid #a855f7; }
    .card-protocol .result-card-header { border-left: 3px solid #ff6b35; }
    .card-script  .result-card-header { border-left: 3px solid #22c55e; }

    .result-card-body {
      padding: 1.25rem;
      font-size: 0.9rem;
      line-height: 1.7;
      color: #ddd;
    }

    .result-card-body .status-red    { color: #ff5555; font-weight: 600; }
    .result-card-body .status-yellow { color: #ffcc44; font-weight: 600; }
    .result-card-body .status-green  { color: #44cc88; font-weight: 600; }

    .result-card-body strong { color: #f0f0f0; }

    .result-card-footer {
      padding: 0.75rem 1.25rem;
      border-top: 1px solid #333;
      display: flex;
      justify-content: flex-end;
    }

    .btn-copy {
      background: none;
      border: 1px solid #444;
      border-radius: 6px;
      color: #888;
      font-size: 0.8rem;
      padding: 0.3rem 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-copy:hover { border-color: #ff6b35; color: #ff6b35; }
    .btn-copy.copied { border-color: #22c55e; color: #22c55e; }

    /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è */
    .empty-state {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 3rem 1.5rem;
      text-align: center;
      color: #555;
    }

    .empty-state .empty-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }
    .empty-state p { font-size: 0.9rem; }

    /* ‚îÄ‚îÄ –ê–¥–∞–ø—Ç–∏–≤ ‚îÄ‚îÄ */
    @media (max-width: 720px) {
      .layout { grid-template-columns: 1fr; }
      header h1 { font-size: 0.95rem; }
      .password-card { padding: 2rem 1.25rem; }
    }
  </style>
</head>
<body>

  <!-- ‚ïê‚ïê –≠–ö–†–ê–ù –ü–ê–†–û–õ–Ø ‚ïê‚ïê -->
  <div id="password-screen">
    <div class="password-card">
      <div class="logo">üß¨</div>
      <h1>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
      <p class="subtitle">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ç—Ä–µ–∫–µ—Ä–∞ –∑–¥–æ—Ä–æ–≤—å—è ¬∑ Coral Club</p>
      <input type="password" id="pwd-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" onkeydown="if(event.key==='Enter') login()">
      <button class="btn-login" onclick="login()">–í–æ–π—Ç–∏</button>
      <div class="error-msg" id="pwd-error"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ‚ïê‚ïê -->
  <div id="app">
    <header>
      <div class="container">
        <span class="header-icon">üß¨</span>
        <div>
          <h1>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ —Ç—Ä–µ–∫–µ—Ä—É –∑–¥–æ—Ä–æ–≤—å—è</h1>
          <div class="tagline">–ú–µ—Ç–æ–¥ –ë—É—Ç–∞–∫–æ–≤–æ–π ¬∑ Coral Club</div>
        </div>
        <button class="logout" onclick="logout()">–í—ã–π—Ç–∏</button>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="layout">

          <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –≤–≤–æ–¥ -->
          <div class="input-panel">
            <h2>–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã -->
            <div class="upload-zone" id="upload-zone">
              <input type="file" id="file-input" accept="image/*" onchange="handleFile(this.files[0])">
              <div id="upload-placeholder">
                <div class="upload-icon">üìä</div>
                <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã</div>
                <div class="upload-hint">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª</div>
              </div>
              <img id="preview" style="display:none" alt="–î–∏–∞–≥—Ä–∞–º–º–∞">
              <button class="change-photo" id="change-btn" style="display:none" onclick="clearImage(event)">–ó–∞–º–µ–Ω–∏—Ç—å</button>
            </div>

            <!-- –ñ–∞–ª–æ–±—ã -->
            <div class="complaints-label">–¢—Ä–∏ –≥–ª–∞–≤–Ω—ã–µ –∂–∞–ª–æ–±—ã –∫–ª–∏–µ–Ω—Ç–∞</div>

            <div class="complaint-row">
              <div class="complaint-num">1</div>
              <input type="text" id="c1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å">
            </div>
            <div class="complaint-row">
              <div class="complaint-num">2</div>
              <input type="text" id="c2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–ª–æ—Ö–æ–π —Å–æ–Ω, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å">
            </div>
            <div class="complaint-row">
              <div class="complaint-num">3</div>
              <input type="text" id="c3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ª–∏—à–Ω–∏–π –≤–µ—Å, –¥–∞–≤–ª–µ–Ω–∏–µ">
            </div>

            <button class="btn-analyze" id="analyze-btn" onclick="analyze()">
              <span id="btn-icon">üîç</span>
              <span id="btn-text">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</span>
            </button>
          </div>

          <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
          <div class="results-panel" id="results-panel">
            <div class="empty-state">
              <div class="empty-icon">üìã</div>
              <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É –∏ —É–∫–∞–∂–∏—Ç–µ –∂–∞–ª–æ–±—ã ‚Äî –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞</p>
            </div>
          </div>

        </div>
      </div>
    </main>
  </div>

<script>
  // ‚îÄ‚îÄ –ü–∞—Ä–æ–ª—å ‚îÄ‚îÄ (—Å–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ—ë)
  const ACCESS_PASSWORD = 'coral2025';

  function login() {
    const val = document.getElementById('pwd-input').value;
    if (val === ACCESS_PASSWORD) {
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      sessionStorage.setItem('auth', '1');
    } else {
      document.getElementById('pwd-error').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
      document.getElementById('pwd-input').focus();
    }
  }

  function logout() {
    sessionStorage.removeItem('auth');
    document.getElementById('password-screen').style.display = 'flex';
    document.getElementById('app').style.display = 'none';
    document.getElementById('pwd-input').value = '';
    document.getElementById('pwd-error').textContent = '';
  }

  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
  if (sessionStorage.getItem('auth') === '1') {
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
  }

  // ‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚îÄ‚îÄ
  let imageBase64 = null;
  let imageMimeType = 'image/jpeg';

  const uploadZone = document.getElementById('upload-zone');

  uploadZone.addEventListener('dragover', e => {
    e.preventDefault();
    uploadZone.classList.add('drag-over');
  });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) handleFile(file);
  });

  function handleFile(file) {
    if (!file) return;
    imageMimeType = file.type || 'image/jpeg';

    // –°–∂–∏–º–∞–µ–º —á–µ—Ä–µ–∑ canvas
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        const maxW = 1200;
        let w = img.width, h = img.height;
        if (w > maxW) { h = Math.round(h * maxW / w); w = maxW; }

        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);

        imageBase64 = canvas.toDataURL('image/jpeg', 0.85).split(',')[1];

        const preview = document.getElementById('preview');
        preview.src = canvas.toDataURL('image/jpeg', 0.85);
        preview.style.display = 'block';
        document.getElementById('upload-placeholder').style.display = 'none';
        document.getElementById('change-btn').style.display = 'block';
        imageMimeType = 'image/jpeg';
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  function clearImage(e) {
    e.stopPropagation();
    imageBase64 = null;
    document.getElementById('preview').style.display = 'none';
    document.getElementById('upload-placeholder').style.display = 'flex';
    document.getElementById('change-btn').style.display = 'none';
    document.getElementById('file-input').value = '';
  }

  // ‚îÄ‚îÄ –ê–Ω–∞–ª–∏–∑ ‚îÄ‚îÄ
  async function analyze() {
    const c1 = document.getElementById('c1').value.trim();
    const c2 = document.getElementById('c2').value.trim();
    const c3 = document.getElementById('c3').value.trim();

    if (!imageBase64) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã');
      return;
    }
    if (!c1) {
      alert('–£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∂–∞–ª–æ–±—É –∫–ª–∏–µ–Ω—Ç–∞');
      return;
    }

    setLoading(true);

    try {
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          image: imageBase64,
          imageType: imageMimeType,
          complaints: [c1, c2, c3].filter(Boolean)
        })
      });

      const data = await res.json();

      if (!res.ok || data.error) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      }

      renderResults(parseResponse(data.result));

    } catch (err) {
      alert('–û—à–∏–±–∫–∞: ' + err.message);
    } finally {
      setLoading(false);
    }
  }

  function setLoading(on) {
    const btn = document.getElementById('analyze-btn');
    const icon = document.getElementById('btn-icon');
    const text = document.getElementById('btn-text');
    btn.disabled = on;
    if (on) {
      icon.outerHTML = '<div class="spinner" id="btn-icon"></div>';
      text.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...';
    } else {
      document.getElementById('btn-icon').outerHTML = '<span id="btn-icon">üîç</span>';
      text.textContent = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É';
    }
  }

  // ‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ (XML-—Ç–µ–≥–∏) ‚îÄ‚îÄ
  function parseResponse(text) {
    const extract = tag => {
      const m = text.match(new RegExp(`<${tag}>[\\s\\S]*?<\\/${tag}>`));
      return m ? m[0].replace(new RegExp(`<\\/?${tag}>`,'g'),'').trim() : '';
    };
    return {
      systems:  extract('—Å–∏—Å—Ç–µ–º—ã'),
      chain:    extract('—Ü–µ–ø–æ—á–∫–∞'),
      protocol: extract('–ø—Ä–æ—Ç–æ–∫–æ–ª'),
      script:   extract('—Å–∫—Ä–∏–ø—Ç')
    };
  }

  // ‚îÄ‚îÄ –†–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç–∞ ‚îÄ‚îÄ
  function renderText(text) {
    return text
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/\[–ü–ï–†–ï–ì–†–£–ó[^\]]*\]/g, m => `<span class="status-red">${m}</span>`)
      .replace(/\[–ù–ê–ì–†–£–ó–ö–ê[^\]]*\]/g, m => `<span class="status-yellow">${m}</span>`)
      .replace(/\[–ù–û–†–ú–ê[^\]]*\]/g,    m => `<span class="status-green">${m}</span>`)
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n/g, '<br>');
  }

  // ‚îÄ‚îÄ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚îÄ‚îÄ
  function renderResults(data) {
    const panel = document.getElementById('results-panel');

    const cards = [
      {
        cls: 'card-systems',
        icon: 'üìä',
        title: '–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º',
        content: data.systems,
        copyable: false
      },
      {
        cls: 'card-chain',
        icon: 'üîó',
        title: '–ü—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞',
        content: data.chain,
        copyable: false
      },
      {
        cls: 'card-protocol',
        icon: 'üíä',
        title: '–ü—Ä–æ—Ç–æ–∫–æ–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (Coral Club)',
        content: data.protocol,
        copyable: false
      },
      {
        cls: 'card-script',
        icon: 'üí¨',
        title: '–°–∫—Ä–∏–ø—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏',
        content: data.script,
        copyable: true
      }
    ];

    panel.innerHTML = cards.map((c, i) => `
      <div class="result-card ${c.cls}" style="animation-delay:${i * 0.08}s">
        <div class="result-card-header">
          ${c.icon} ${c.title}
        </div>
        <div class="result-card-body">
          ${renderText(c.content || '‚Äî')}
        </div>
        ${c.copyable ? `
        <div class="result-card-footer">
          <button class="btn-copy" onclick="copyText(this, \`${escapeBacktick(c.content)}\`)">
            –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
          </button>
        </div>` : ''}
      </div>
    `).join('');
  }

  function escapeBacktick(str) {
    return (str || '').replace(/\\/g,'\\\\').replace(/`/g,'\\`').replace(/\$/g,'\\$');
  }

  function copyText(btn, text) {
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç';
        btn.classList.remove('copied');
      }, 2000);
    });
  }
</script>

</body>
</html>
