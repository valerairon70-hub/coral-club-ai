<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Äî –¢—Ä–µ–∫–µ—Ä –∑–¥–æ—Ä–æ–≤—å—è</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #1a1a1a;
      color: #f0f0f0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –ø–∞—Ä–æ–ª—è ‚îÄ‚îÄ */
    #password-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .password-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    .password-card .logo { font-size: 2.5rem; margin-bottom: 0.5rem; }

    .password-card h1 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: #f0f0f0;
    }

    .password-card .subtitle {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 2rem;
    }

    .password-card input[type="password"] {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: #f0f0f0;
      font-size: 1rem;
      margin-bottom: 0.75rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .password-card input[type="password"]:focus { border-color: #ff6b35; }

    .password-card .btn-login {
      width: 100%;
      background: #ff6b35;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .password-card .btn-login:hover { background: #e85d2a; }

    .error-msg {
      color: #ff5555;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      min-height: 1.2em;
    }

    /* ‚îÄ‚îÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚îÄ‚îÄ */
    #app { display: none; }

    /* ‚îÄ‚îÄ –•–µ–¥–µ—Ä ‚îÄ‚îÄ */
    header {
      background: #242424;
      border-bottom: 1px solid #333;
      padding: 0.85rem 0;
    }

    header .container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    /* ‚îÄ‚îÄ DNA –∞–Ω–∏–º–∞—Ü–∏—è ‚îÄ‚îÄ */
    .dna-animated {
      animation: dnaHelix 3s ease-in-out infinite;
      transform-origin: center center;
      display: block;
    }

    @keyframes dnaHelix {
      0%   { transform: scaleX(1);    filter: drop-shadow(0 0 5px rgba(192,132,252,0.85)); }
      25%  { transform: scaleX(0.05); filter: drop-shadow(0 0 11px rgba(34,211,238,1));    }
      50%  { transform: scaleX(-1);   filter: drop-shadow(0 0 5px rgba(192,132,252,0.85)); }
      75%  { transform: scaleX(0.05); filter: drop-shadow(0 0 11px rgba(34,211,238,1));    }
      100% { transform: scaleX(1);    filter: drop-shadow(0 0 5px rgba(192,132,252,0.85)); }
    }

    header .header-icon { line-height: 1; }

    header h1 {
      font-size: 1rem;
      font-weight: 700;
      color: #f0f0f0;
    }

    header .tagline {
      font-size: 0.7rem;
      color: #666;
    }

    header .logout {
      margin-left: auto;
      background: none;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0.3rem 0.75rem;
      color: #888;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    header .logout:hover { border-color: #ff6b35; color: #ff6b35; }

    .container {
      max-width: 980px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* ‚îÄ‚îÄ –í–∫–ª–∞–¥–∫–∏ ‚îÄ‚îÄ */
    .tab-nav {
      background: #1e1e1e;
      border-bottom: 1px solid #2a2a2a;
      padding: 0;
    }

    .tab-nav .container {
      display: flex;
      gap: 0;
    }

    .tab-btn {
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      padding: 0.85rem 1.25rem;
      color: #666;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .tab-btn:hover { color: #bbb; }

    .tab-btn.active {
      color: #ff6b35;
      border-bottom-color: #ff6b35;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    main { padding: 1.5rem 0 3rem; }

    /* ‚îÄ‚îÄ 2-–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π layout ‚îÄ‚îÄ */
    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start;
    }

    /* ‚îÄ‚îÄ –ü–∞–Ω–µ–ª–∏ –≤–≤–æ–¥–∞ (–æ–±—â–∏–µ —Å—Ç–∏–ª–∏) ‚îÄ‚îÄ */
    .input-panel {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 1.5rem;
    }

    .input-panel h2 {
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 1.25rem;
      color: #f0f0f0;
    }

    .field-label {
      font-size: 0.82rem;
      font-weight: 600;
      color: #999;
      margin-bottom: 0.5rem;
    }

    .field-group { margin-bottom: 1.1rem; }

    textarea.field-input, input.field-input {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 0.65rem 0.85rem;
      color: #f0f0f0;
      font-size: 0.88rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      resize: vertical;
    }

    textarea.field-input:focus, input.field-input:focus { border-color: #ff6b35; }
    textarea.field-input::placeholder, input.field-input::placeholder { color: #555; }

    /* ‚îÄ‚îÄ –°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä (—ç—Ç–∞–ø / –Ω–∞—Å—Ç—Ä–æ–π) ‚îÄ‚îÄ */
    .seg-control {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .seg-option {
      display: none;
    }

    .seg-option + label {
      display: inline-flex;
      align-items: center;
      padding: 0.4rem 0.75rem;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 20px;
      font-size: 0.78rem;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .seg-option:checked + label {
      background: rgba(255, 107, 53, 0.15);
      border-color: #ff6b35;
      color: #ff6b35;
    }

    .seg-option + label:hover { border-color: #666; color: #ccc; }

    /* ‚îÄ‚îÄ –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ –∫–∞–Ω–∞–ª–∞ ‚îÄ‚îÄ */
    .channel-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.4rem;
    }

    .channel-option { display: none; }

    .channel-option + label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.55rem 0.75rem;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      font-size: 0.82rem;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .channel-option:checked + label {
      background: rgba(255, 107, 53, 0.12);
      border-color: #ff6b35;
      color: #f0f0f0;
    }

    .channel-option + label:hover { border-color: #555; color: #ccc; }

    /* ‚îÄ‚îÄ –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ‚îÄ‚îÄ */
    .upload-zone {
      border: 2px dashed #444;
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1.1rem;
      min-height: 130px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .upload-zone:hover, .upload-zone.drag-over {
      border-color: #ff6b35;
      background: rgba(255, 107, 53, 0.05);
    }

    .upload-zone .upload-icon { font-size: 1.8rem; margin-bottom: 0.4rem; }

    .upload-zone .upload-text {
      font-size: 0.88rem;
      color: #bbb;
      margin-bottom: 0.2rem;
    }

    .upload-zone .upload-hint { font-size: 0.75rem; color: #666; }

    /* Thumbnails */
    .thumbs-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .thumb-item {
      position: relative;
      width: 68px;
      height: 68px;
      flex-shrink: 0;
    }

    .thumb-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #444;
    }

    .thumb-remove {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      background: #ff5555;
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;
      padding: 0;
      line-height: 1;
    }

    .upload-add-more {
      font-size: 0.78rem;
      color: #ff6b35;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    /* ‚îÄ‚îÄ –ñ–∞–ª–æ–±—ã ‚îÄ‚îÄ */
    .complaint-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .complaint-num {
      width: 22px;
      height: 22px;
      background: #333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.72rem;
      font-weight: 700;
      color: #ff6b35;
      flex-shrink: 0;
    }

    .complaint-row input {
      flex: 1;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 0.55rem 0.75rem;
      color: #f0f0f0;
      font-size: 0.88rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .complaint-row input:focus { border-color: #ff6b35; }
    .complaint-row input::placeholder { color: #555; }

    /* ‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚îÄ‚îÄ */
    .btn-action {
      width: 100%;
      background: #ff6b35;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.8rem;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 1.1rem;
      transition: background 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-action:hover:not(:disabled) { background: #e85d2a; }
    .btn-action:active:not(:disabled) { transform: scale(0.98); }
    .btn-action:disabled { background: #555; cursor: not-allowed; }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚îÄ‚îÄ */
    .results-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .result-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      overflow: hidden;
      animation: fadeIn 0.35s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

    .result-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85rem 1.1rem;
      border-bottom: 1px solid #2a2a2a;
    }

    .result-card-header .card-title {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      font-weight: 700;
      font-size: 0.85rem;
    }

    /* –¶–≤–µ—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ –ø–æ –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü–µ */
    .card-systems  .result-card-header { border-left: 3px solid #4a9eff; }
    .card-chain    .result-card-header { border-left: 3px solid #a855f7; }
    .card-protocol .result-card-header { border-left: 3px solid #ff6b35; }
    .card-script   .result-card-header { border-left: 3px solid #22c55e; }
    .card-logic    .result-card-header { border-left: 3px solid #f59e0b; }
    .card-direct   .result-card-header { border-left: 3px solid #4a9eff; }
    .card-story    .result-card-header { border-left: 3px solid #a855f7; }
    .card-question .result-card-header { border-left: 3px solid #22c55e; }
    .card-followup .result-card-header { border-left: 3px solid #ff6b35; }
    .card-tip      .result-card-header { border-left: 3px solid #f59e0b; }

    .result-card-body {
      padding: 1.1rem;
      font-size: 0.88rem;
      line-height: 1.7;
      color: #ddd;
    }

    .result-card-body .status-red    { color: #ff5555; font-weight: 600; }
    .result-card-body .status-yellow { color: #ffcc44; font-weight: 600; }
    .result-card-body .status-green  { color: #44cc88; font-weight: 600; }
    .result-card-body strong { color: #f0f0f0; }

    .btn-copy {
      background: none;
      border: 1px solid #3a3a3a;
      border-radius: 6px;
      color: #777;
      font-size: 0.75rem;
      padding: 0.25rem 0.65rem;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .btn-copy:hover { border-color: #ff6b35; color: #ff6b35; }
    .btn-copy.copied { border-color: #22c55e; color: #22c55e; }

    /* ‚îÄ‚îÄ –ë–ª–æ–∫ –∏—Å—Ö–æ–¥–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ‚îÄ‚îÄ */
    .outcome-block {
      background: #1e2a1e;
      border: 1px solid #2d3d2d;
      border-radius: 12px;
      padding: 1rem 1.1rem;
      animation: fadeIn 0.35s ease;
    }

    .outcome-block h3 {
      font-size: 0.82rem;
      font-weight: 700;
      color: #888;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .outcome-btns {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }

    .btn-outcome {
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 0.45rem 0.85rem;
      color: #aaa;
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-outcome:hover { border-color: #666; color: #eee; }
    .btn-outcome.selected-bought  { background: rgba(34,197,94,0.15); border-color: #22c55e; color: #22c55e; }
    .btn-outcome.selected-thinking { background: rgba(251,191,36,0.12); border-color: #fbbf24; color: #fbbf24; }
    .btn-outcome.selected-rejected { background: rgba(239,68,68,0.12); border-color: #ef4444; color: #ef4444; }
    .btn-outcome.selected-objection { background: rgba(168,85,247,0.12); border-color: #a855f7; color: #a855f7; }

    .objection-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .objection-row input {
      flex: 1;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      color: #f0f0f0;
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .objection-row input:focus { border-color: #a855f7; }
    .objection-row input::placeholder { color: #555; }

    .btn-save-outcome {
      background: #ff6b35;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      color: #fff;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-save-outcome:hover { background: #e85d2a; }

    .outcome-saved {
      font-size: 0.82rem;
      color: #22c55e;
      text-align: center;
      padding: 0.4rem;
    }

    /* ‚îÄ‚îÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è ‚îÄ‚îÄ */
    .empty-state {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 3rem 1.5rem;
      text-align: center;
      color: #555;
    }

    .empty-state .empty-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }
    .empty-state p { font-size: 0.88rem; }

    /* ‚îÄ‚îÄ –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚îÄ‚îÄ */
    .stats-layout { padding: 0; }

    .stats-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1.1rem;
      text-align: center;
    }

    .stat-card .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: #ff6b35;
      line-height: 1;
      margin-bottom: 0.3rem;
    }

    .stat-card .stat-label {
      font-size: 0.78rem;
      color: #888;
    }

    .stats-section {
      background: #242424;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .stats-section h3 {
      font-size: 0.88rem;
      font-weight: 700;
      color: #bbb;
      margin-bottom: 1rem;
    }

    .filter-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .btn-filter {
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 20px;
      padding: 0.35rem 0.85rem;
      color: #888;
      font-size: 0.78rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-filter.active {
      background: rgba(255, 107, 53, 0.15);
      border-color: #ff6b35;
      color: #ff6b35;
    }

    .btn-filter:hover:not(.active) { border-color: #555; color: #ccc; }

    .records-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

    .records-table th {
      text-align: left;
      padding: 0.5rem 0.75rem;
      color: #666;
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      border-bottom: 1px solid #2a2a2a;
    }

    .records-table td {
      padding: 0.65rem 0.75rem;
      border-bottom: 1px solid #222;
      color: #ccc;
      vertical-align: top;
    }

    .records-table tr:last-child td { border-bottom: none; }

    .outcome-pill {
      display: inline-block;
      padding: 0.2rem 0.55rem;
      border-radius: 20px;
      font-size: 0.72rem;
      font-weight: 600;
    }

    .pill-bought    { background: rgba(34,197,94,0.15);  color: #22c55e; }
    .pill-thinking  { background: rgba(251,191,36,0.12); color: #fbbf24; }
    .pill-rejected  { background: rgba(239,68,68,0.12);  color: #ef4444; }
    .pill-objection { background: rgba(168,85,247,0.12); color: #a855f7; }
    .pill-pending   { background: rgba(100,100,100,0.15); color: #888; }

    .type-pill {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .type-invite  { background: rgba(74,158,255,0.12); color: #4a9eff; }
    .type-decode  { background: rgba(255,107,53,0.12); color: #ff6b35; }

    .objection-tag {
      display: inline-block;
      background: rgba(168,85,247,0.1);
      border: 1px solid rgba(168,85,247,0.3);
      border-radius: 4px;
      padding: 0.1rem 0.4rem;
      font-size: 0.72rem;
      color: #c084fc;
      margin: 0.15rem 0.15rem 0 0;
    }

    .no-records {
      text-align: center;
      color: #555;
      padding: 2rem;
      font-size: 0.88rem;
    }

    .btn-export {
      background: none;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 0.5rem 1.1rem;
      color: #888;
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-export:hover { border-color: #ff6b35; color: #ff6b35; }

    .btn-clear-stats {
      background: none;
      border: 1px solid #3a2a2a;
      border-radius: 8px;
      padding: 0.5rem 1.1rem;
      color: #666;
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-clear-stats:hover { border-color: #ff5555; color: #ff5555; }

    .top-objections-list { list-style: none; }

    .top-objections-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #222;
      font-size: 0.85rem;
      color: #ccc;
    }

    .top-objections-list li:last-child { border-bottom: none; }

    .obj-count {
      background: rgba(168,85,247,0.15);
      color: #a855f7;
      padding: 0.15rem 0.55rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    /* ‚îÄ‚îÄ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ª–∏–º–∏—Ç–∞ ‚îÄ‚îÄ */
    .limit-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.82);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 1rem;
      backdrop-filter: blur(4px);
    }

    .limit-card {
      background: #242424;
      border: 1px solid #444;
      border-radius: 20px;
      padding: 2.5rem 2rem;
      max-width: 420px;
      width: 100%;
      text-align: center;
    }

    .limit-card .limit-icon { font-size: 3rem; margin-bottom: 1rem; }

    .limit-card h2 {
      font-size: 1.3rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      color: #f0f0f0;
    }

    .limit-card .limit-sub {
      font-size: 0.88rem;
      color: #888;
      margin-bottom: 1.75rem;
      line-height: 1.6;
    }

    .limit-card .limit-sub strong { color: #f0f0f0; }

    .contact-btns {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .btn-contact {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      padding: 0.85rem 1rem;
      border: none;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: opacity 0.2s;
    }

    .btn-contact:hover { opacity: 0.88; }

    .btn-wa   { background: #25d366; color: #fff; }
    .btn-tg   { background: #229ed9; color: #fff; }

    /* ‚îÄ‚îÄ –ê–¥–∞–ø—Ç–∏–≤ ‚îÄ‚îÄ */
    @media (max-width: 720px) {
      .layout { grid-template-columns: 1fr; }
      header h1 { font-size: 0.9rem; }
      .password-card { padding: 2rem 1.25rem; }
      .stats-summary { grid-template-columns: repeat(3, 1fr); }
      .tab-btn { padding: 0.75rem 0.85rem; font-size: 0.78rem; }
      .tab-btn .tab-icon { display: none; }
      .channel-grid { grid-template-columns: 1fr 1fr; }
      .records-table { font-size: 0.75rem; }
      .records-table th, .records-table td { padding: 0.5rem 0.5rem; }
    }

    @media (max-width: 480px) {
      .stats-summary { grid-template-columns: 1fr 1fr; }
      .stats-summary .stat-card:last-child { grid-column: span 2; }
    }
  </style>
</head>
<body>

  <!-- ‚ïê‚ïê –≠–ö–†–ê–ù –ü–ê–†–û–õ–Ø ‚ïê‚ïê -->
  <div id="password-screen">
    <div class="password-card">
      <div class="logo">
        <svg class="dna-animated" viewBox="0 0 32 36" width="52" height="58" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7 3 Q25 9 25 18 Q25 27 7 33" stroke="#c084fc" stroke-width="2.6" stroke-linecap="round"/>
          <path d="M25 3 Q7 9 7 18 Q7 27 25 33" stroke="#22d3ee" stroke-width="2.6" stroke-linecap="round" opacity="0.9"/>
          <line x1="11" y1="8.5"  x2="21" y2="8.5"  stroke="rgba(255,255,255,0.28)" stroke-width="1.6" stroke-linecap="round"/>
          <line x1="7"  y1="18"   x2="25" y2="18"   stroke="rgba(255,255,255,0.18)" stroke-width="1.3" stroke-linecap="round"/>
          <line x1="11" y1="27.5" x2="21" y2="27.5" stroke="rgba(255,255,255,0.28)" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </div>
      <h1>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
      <p class="subtitle">–¢—Ä–µ–∫–µ—Ä –∑–¥–æ—Ä–æ–≤—å—è ¬∑ Coral Club ¬∑ –ú–µ—Ç–æ–¥ –ë—É—Ç–∞–∫–æ–≤–æ–π</p>
      <input type="password" id="pwd-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" onkeydown="if(event.key==='Enter') login()">
      <button class="btn-login" onclick="login()">–í–æ–π—Ç–∏</button>
      <div class="error-msg" id="pwd-error"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –õ–ò–ú–ò–¢–ê ‚ïê‚ïê -->
  <div class="limit-overlay" id="limit-overlay" style="display:none">
    <div class="limit-card">
      <div class="limit-icon">üîí</div>
      <h2>–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∏—Å—á–µ—Ä–ø–∞–Ω</h2>
      <p class="limit-sub">
        –í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ <strong>10 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</strong>.<br>
        –ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–≤—Ç–æ—Ä–æ–º ‚Äî <strong>–í–∞–ª–µ—Ä–∏–µ–º –°–æ–∑–∞–Ω–æ–≤—ã–º</strong>:
      </p>
      <div class="contact-btns">
        <a class="btn-contact btn-wa" href="https://wa.me/79627445758" target="_blank">
          üí¨ WhatsApp: +7 962 744-57-58
        </a>
        <a class="btn-contact btn-tg" href="https://t.me/valeriisozanov" target="_blank">
          ‚úàÔ∏è Telegram: @valeriisozanov
        </a>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ‚ïê‚ïê -->
  <div id="app">
    <header>
      <div class="container">
        <span class="header-icon">
          <svg class="dna-animated" viewBox="0 0 32 36" width="26" height="30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 3 Q25 9 25 18 Q25 27 7 33" stroke="#c084fc" stroke-width="2.6" stroke-linecap="round"/>
            <path d="M25 3 Q7 9 7 18 Q7 27 25 33" stroke="#22d3ee" stroke-width="2.6" stroke-linecap="round" opacity="0.9"/>
            <line x1="11" y1="8.5"  x2="21" y2="8.5"  stroke="rgba(255,255,255,0.28)" stroke-width="1.6" stroke-linecap="round"/>
            <line x1="7"  y1="18"   x2="25" y2="18"   stroke="rgba(255,255,255,0.18)" stroke-width="1.3" stroke-linecap="round"/>
            <line x1="11" y1="27.5" x2="21" y2="27.5" stroke="rgba(255,255,255,0.28)" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </span>
        <div>
          <h1>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ —Ç—Ä–µ–∫–µ—Ä—É –∑–¥–æ—Ä–æ–≤—å—è</h1>
          <div class="tagline">–ú–µ—Ç–æ–¥ –ë—É—Ç–∞–∫–æ–≤–æ–π ¬∑ Coral Club</div>
        </div>
        <button class="logout" onclick="logout()">–í—ã–π—Ç–∏</button>
      </div>
    </header>

    <!-- ‚îÄ‚îÄ –í–∫–ª–∞–¥–∫–∏ ‚îÄ‚îÄ -->
    <nav class="tab-nav">
      <div class="container">
        <button class="tab-btn active" onclick="switchTab('invite')">
          <span class="tab-icon">ü§ù</span> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
        </button>
        <button class="tab-btn" onclick="switchTab('decode')">
          <span class="tab-icon">üîç</span> –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="tab-btn" onclick="switchTab('stats')">
          <span class="tab-icon">üìä</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </button>
      </div>
    </nav>

    <main>
      <div class="container">

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             –í–ö–õ–ê–î–ö–ê 1: –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –ù–ê –¢–†–ï–ö–ï–†
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="tab-panel active" id="panel-invite">
          <div class="layout">

            <!-- –§–æ—Ä–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
            <div class="input-panel">
              <h2>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–∞ —Ç—Ä–µ–∫–µ—Ä –∑–¥–æ—Ä–æ–≤—å—è</h2>

              <div class="field-group">
                <div class="field-label">–ö—Ç–æ —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫?</div>
                <textarea class="field-input" id="inv-person" rows="3"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–¥—Ä—É–≥–∞, –º–∞–º–∞ –¥–≤–æ–∏—Ö –¥–µ—Ç–µ–π, 38 –ª–µ—Ç. –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ñ–∏—Å–µ, –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ –ø–ª–æ—Ö–æ–π —Å–æ–Ω. –ê–∫—Ç–∏–≤–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –∑–¥–æ—Ä–æ–≤—å–µ–º, —Å–ª–µ–¥–∏—Ç –∑–∞ –ø–∏—Ç–∞–Ω–∏–µ–º."></textarea>
              </div>

              <div class="field-group">
                <div class="field-label">–ß—Ç–æ –∑–Ω–∞–µ—à—å –æ –µ–≥–æ/–µ—ë –∑–¥–æ—Ä–æ–≤—å–µ? <span style="color:#555">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></div>
                <textarea class="field-input" id="inv-hints" rows="2"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ–¥–∞–≤–Ω–æ –≥–æ–≤–æ—Ä–∏–ª–∞ –æ –ª–∏—à–Ω–µ–º –≤–µ—Å–µ, —É–ø–æ–º–∏–Ω–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å—É—Å—Ç–∞–≤–∞–º–∏"></textarea>
              </div>

              <div class="field-group">
                <div class="field-label">–ö–∞–Ω–∞–ª –æ–±—â–µ–Ω–∏—è</div>
                <div class="channel-grid">
                  <input type="radio" name="channel" id="ch-wa" value="whatsapp" class="channel-option" checked>
                  <label for="ch-wa">üí¨ WhatsApp / Telegram</label>
                  <input type="radio" name="channel" id="ch-ig" value="instagram" class="channel-option">
                  <label for="ch-ig">üì∏ Instagram / —Å–æ—Ü—Å–µ—Ç–∏</label>
                  <input type="radio" name="channel" id="ch-live" value="person" class="channel-option">
                  <label for="ch-live">üó£ –õ–∏—á–Ω–æ / –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
                  <input type="radio" name="channel" id="ch-zoom" value="zoom" class="channel-option">
                  <label for="ch-zoom">üíª Zoom / –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</label>
                </div>
              </div>

              <button class="btn-action" id="invite-btn" onclick="generateInvite()">
                <span id="invite-btn-icon">‚úâÔ∏è</span>
                <span id="invite-btn-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</span>
              </button>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
            <div class="results-panel" id="invite-results">
              <div class="empty-state">
                <div class="empty-icon">‚úâÔ∏è</div>
                <p>–û–ø–∏—à–∏ —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî –ø–æ–ª—É—á–∏—à—å 3 –≥–æ—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∏ —Å–æ–≤–µ—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –Ω–∏–º</p>
              </div>
            </div>

          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             –í–ö–õ–ê–î–ö–ê 2: –†–ê–°–®–ò–§–†–û–í–ê–¢–¨ –¢–†–ï–ö–ï–†
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="tab-panel" id="panel-decode">
          <div class="layout">

            <!-- –§–æ—Ä–º–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ -->
            <div class="input-panel">
              <h2>–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>

              <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã -->
              <div class="field-group">
                <div class="field-label">–°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∏–∞–≥—Ä–∞–º–º—ã</div>
                <div class="upload-zone" id="upload-zone">
                  <input type="file" id="file-input" accept="image/*" multiple style="display:none">
                  <div id="upload-placeholder">
                    <div class="upload-icon">üìä</div>
                    <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∏–∞–≥—Ä–∞–º–º—ã</div>
                    <div class="upload-hint">–ú–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —Å—Ä–∞–∑—É</div>
                  </div>
                  <div id="thumbs-container" style="display:none; flex-direction:column; align-items:center; width:100%; gap:0.5rem; padding:0.5rem 0;">
                    <div class="thumbs-grid" id="thumbs-grid"></div>
                    <span class="upload-add-more">+ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Å–∫—Ä–∏–Ω—à–æ—Ç—ã</span>
                  </div>
                </div>
              </div>

              <!-- –ñ–∞–ª–æ–±—ã -->
              <div class="field-group">
                <div class="field-label">–¢—Ä–∏ –≥–ª–∞–≤–Ω—ã–µ –∂–∞–ª–æ–±—ã –∫–ª–∏–µ–Ω—Ç–∞</div>
                <div class="complaint-row">
                  <div class="complaint-num">1</div>
                  <input type="text" id="c1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å">
                </div>
                <div class="complaint-row">
                  <div class="complaint-num">2</div>
                  <input type="text" id="c2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–ª–æ—Ö–æ–π —Å–æ–Ω, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å">
                </div>
                <div class="complaint-row">
                  <div class="complaint-num">3</div>
                  <input type="text" id="c3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ª–∏—à–Ω–∏–π –≤–µ—Å, —Å–∫–∞—á–∫–∏ –¥–∞–≤–ª–µ–Ω–∏—è">
                </div>
              </div>

              <!-- –≠—Ç–∞–ø —Ä–∞–±–æ—Ç—ã -->
              <div class="field-group">
                <div class="field-label">–≠—Ç–∞–ø —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º</div>
                <div class="seg-control">
                  <input type="radio" name="stage" id="st-first" value="first_contact" class="seg-option" checked>
                  <label for="st-first">–ü–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç</label>
                  <input type="radio" name="stage" id="st-m1" value="month1" class="seg-option">
                  <label for="st-m1">–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ (–º–µ—Å. 1)</label>
                  <input type="radio" name="stage" id="st-m2" value="month2" class="seg-option">
                  <label for="st-m2">–ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä</label>
                </div>
              </div>

              <!-- –ù–∞—Å—Ç—Ä–æ–π –∫–ª–∏–µ–Ω—Ç–∞ -->
              <div class="field-group">
                <div class="field-label">–ù–∞—Å—Ç—Ä–æ–π –∫–ª–∏–µ–Ω—Ç–∞</div>
                <div class="seg-control">
                  <input type="radio" name="readiness" id="rd-open" value="open" class="seg-option" checked>
                  <label for="rd-open">–û—Ç–∫—Ä—ã—Ç—ã–π ‚úì</label>
                  <input type="radio" name="readiness" id="rd-think" value="thinking" class="seg-option">
                  <label for="rd-think">–î—É–º–∞–µ—Ç...</label>
                  <input type="radio" name="readiness" id="rd-skep" value="skeptic" class="seg-option">
                  <label for="rd-skep">–°–∫–µ–ø—Ç–∏–∫</label>
                </div>
              </div>

              <button class="btn-action" id="analyze-btn" onclick="analyze()">
                <span id="btn-icon">üîç</span>
                <span id="btn-text">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</span>
              </button>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ -->
            <div class="results-panel" id="decode-results">
              <div class="empty-state">
                <div class="empty-icon">üìã</div>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É, —É–∫–∞–∂–∏—Ç–µ –∂–∞–ª–æ–±—ã –∏ —ç—Ç–∞–ø ‚Äî –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞</p>
              </div>
            </div>

          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             –í–ö–õ–ê–î–ö–ê 3: –°–¢–ê–¢–ò–°–¢–ò–ö–ê
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="tab-panel" id="panel-stats">
          <div id="stats-content"></div>
        </div>

      </div>
    </main>
  </div>

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const ACCESS_PASSWORD = 'coral2025';   // –æ—Å–Ω–æ–≤–Ω–æ–π ‚Äî –±–µ–∑ –ª–∏–º–∏—Ç–∞
  const TEST_PASSWORD   = 'test2025';    // —Ç–µ—Å—Ç–æ–≤—ã–π ‚Äî 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
  const TEST_LIMIT      = 10;

  function login() {
    const val = document.getElementById('pwd-input').value;
    if (val === ACCESS_PASSWORD) {
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      sessionStorage.setItem('auth', 'main');
    } else if (val === TEST_PASSWORD) {
      // –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω –ª–∏ –ª–∏–º–∏—Ç
      if (getTestCount() >= TEST_LIMIT) {
        showLimitModal();
        return;
      }
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      sessionStorage.setItem('auth', 'test');
    } else {
      document.getElementById('pwd-error').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
      document.getElementById('pwd-input').focus();
    }
  }

  function logout() {
    sessionStorage.removeItem('auth');
    document.getElementById('password-screen').style.display = 'flex';
    document.getElementById('app').style.display = 'none';
    document.getElementById('limit-overlay').style.display = 'none';
    document.getElementById('pwd-input').value = '';
    document.getElementById('pwd-error').textContent = '';
  }

  const stored = sessionStorage.getItem('auth');
  if (stored === 'main' || stored === 'test') {
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
  }

  // ‚îÄ‚îÄ –°—á—ë—Ç—á–∏–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π ‚îÄ‚îÄ
  function getTestCount() {
    return parseInt(localStorage.getItem('cc_test_count') || '0', 10);
  }

  function incrementTestCounter() {
    localStorage.setItem('cc_test_count', getTestCount() + 1);
  }

  function isTestMode() {
    return sessionStorage.getItem('auth') === 'test';
  }

  function checkTestLimit() {
    if (!isTestMode()) return true; // –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å ‚Äî –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if (getTestCount() >= TEST_LIMIT) {
      showLimitModal();
      return false;
    }
    return true;
  }

  function showLimitModal() {
    document.getElementById('limit-overlay').style.display = 'flex';
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –í–ö–õ–ê–î–ö–ò
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  function switchTab(name) {
    document.querySelectorAll('.tab-btn').forEach((btn, i) => {
      btn.classList.toggle('active', ['invite','decode','stats'][i] === name);
    });
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('panel-' + name).classList.add('active');
    if (name === 'stats') renderStats();
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (–º–∏–Ω–∏-CRM)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  function getRecords() {
    try { return JSON.parse(localStorage.getItem('cc_records') || '[]'); } catch { return []; }
  }

  function saveRecord(rec) {
    const records = getRecords();
    const idx = records.findIndex(r => r.id === rec.id);
    if (idx >= 0) records[idx] = rec;
    else records.unshift(rec);
    localStorage.setItem('cc_records', JSON.stringify(records));
  }

  function genId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2, 6);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  let uploadedImages = [];

  const uploadZone = document.getElementById('upload-zone');
  const fileInput  = document.getElementById('file-input');

  uploadZone.addEventListener('click', e => {
    if (e.target.classList.contains('thumb-remove')) return;
    fileInput.click();
  });

  fileInput.addEventListener('change', function() {
    handleFiles(this.files);
    this.value = '';
  });

  uploadZone.addEventListener('dragover',  e => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
  uploadZone.addEventListener('dragleave', ()  => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    handleFiles(e.dataTransfer.files);
  });

  function handleFiles(files) {
    Array.from(files).forEach(file => {
      if (!file || !file.type.startsWith('image/')) return;
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          const maxW = 1200;
          let w = img.width, h = img.height;
          if (w > maxW) { h = Math.round(h * maxW / w); w = maxW; }
          const canvas = document.createElement('canvas');
          canvas.width = w; canvas.height = h;
          canvas.getContext('2d').drawImage(img, 0, 0, w, h);
          const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
          uploadedImages.push({ base64: dataUrl.split(',')[1], mimeType: 'image/jpeg', previewUrl: dataUrl });
          renderThumbnails();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  function renderThumbnails() {
    const placeholder = document.getElementById('upload-placeholder');
    const container   = document.getElementById('thumbs-container');
    const grid        = document.getElementById('thumbs-grid');
    if (uploadedImages.length === 0) {
      placeholder.style.display = 'flex';
      container.style.display   = 'none';
      return;
    }
    placeholder.style.display = 'none';
    container.style.display   = 'flex';
    grid.innerHTML = uploadedImages.map((img, i) => `
      <div class="thumb-item">
        <img src="${img.previewUrl}" alt="–°–∫—Ä–∏–Ω—à–æ—Ç ${i + 1}">
        <button class="thumb-remove" onclick="removeImage(${i}, event)">√ó</button>
      </div>
    `).join('');
  }

  function removeImage(index, e) {
    e.stopPropagation();
    uploadedImages.splice(index, 1);
    renderThumbnails();
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –í–ö–õ–ê–î–ö–ê 1: –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ô
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function generateInvite() {
    const personDesc = document.getElementById('inv-person').value.trim();
    if (!personDesc) { alert('–û–ø–∏—à–∏ —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî —Ö–æ—Ç—è –±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤'); return; }
    if (!checkTestLimit()) return;

    const channel = document.querySelector('input[name="channel"]:checked')?.value || 'whatsapp';
    const hints   = document.getElementById('inv-hints').value.trim();

    setInviteLoading(true);

    try {
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ mode: 'invite', clientDesc: personDesc, healthHints: hints, channel })
      });

      const data = await res.json();
      if (!res.ok || data.error) throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');

      const parsed = parseInviteResponse(data.result);
      renderInviteResults(parsed, personDesc);
      if (isTestMode()) incrementTestCounter();

    } catch (err) {
      alert('–û—à–∏–±–∫–∞: ' + err.message);
    } finally {
      setInviteLoading(false);
    }
  }

  function setInviteLoading(on) {
    const btn  = document.getElementById('invite-btn');
    const icon = document.getElementById('invite-btn-icon');
    const text = document.getElementById('invite-btn-text');
    btn.disabled = on;
    if (on) {
      icon.outerHTML = '<div class="spinner" id="invite-btn-icon"></div>';
      text.textContent = '–ì–æ—Ç–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç—ã...';
    } else {
      document.getElementById('invite-btn-icon').outerHTML = '<span id="invite-btn-icon">‚úâÔ∏è</span>';
      text.textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è';
    }
  }

  function parseInviteResponse(text) {
    const extract = tag => {
      const m = text.match(new RegExp(`<${tag}>[\\s\\S]*?<\\/${tag}>`));
      return m ? m[0].replace(new RegExp(`<\\/?${tag}>`,'g'),'').trim() : '';
    };
    return {
      direct:    extract('–ø—Ä—è–º–æ–π'),
      story:     extract('–∏—Å—Ç–æ—Ä–∏—è'),
      question:  extract('–≤–æ–ø—Ä–æ—Å'),
      followup:  extract('–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ_–∫–∞—Å–∞–Ω–∏–µ'),
      tip:       extract('—Å–æ–≤–µ—Ç_–¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä—É')
    };
  }

  function renderInviteResults(data, personDesc) {
    const panel = document.getElementById('invite-results');
    const recId = genId();

    const cards = [
      { cls: 'card-direct',   icon: 'üí¨', title: '–ü—Ä—è–º–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ',       content: data.direct,   copyable: true },
      { cls: 'card-story',    icon: 'üìñ', title: '–ß–µ—Ä–µ–∑ –∏—Å—Ç–æ—Ä–∏—é',            content: data.story,    copyable: true },
      { cls: 'card-question', icon: '‚ùì', title: '–í–æ–ø—Ä–æ—Å-–∫—Ä—é—á–æ–∫',            content: data.question, copyable: true },
      { cls: 'card-followup', icon: 'üîÑ', title: '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ',        content: data.followup, copyable: true },
      { cls: 'card-tip',      icon: 'üí°', title: '–°–æ–≤–µ—Ç –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä—É',      content: data.tip,      copyable: false }
    ];

    panel.innerHTML = cards.map((c, i) => `
      <div class="result-card ${c.cls}" style="animation-delay:${i * 0.07}s">
        <div class="result-card-header">
          <div class="card-title">${c.icon} ${c.title}</div>
          ${c.copyable ? `<button class="btn-copy" onclick="copyText(this, \`${escBt(c.content)}\`)">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>` : ''}
        </div>
        <div class="result-card-body">${renderText(c.content || '‚Äî')}</div>
      </div>
    `).join('') + renderInviteOutcomeBlock(recId, personDesc);
  }

  function renderInviteOutcomeBlock(recId, personDesc) {
    return `
      <div class="outcome-block" id="outcome-${recId}">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h3>
        <div class="outcome-btns">
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'bought', 'invite', '${escBt(personDesc)}', this)">‚úÖ –°–æ–≥–ª–∞—Å–∏–ª—Å—è –ø—Ä–æ–π—Ç–∏</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'thinking', 'invite', '${escBt(personDesc)}', this)">ü§î –î—É–º–∞–µ—Ç</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'rejected', 'invite', '${escBt(personDesc)}', this)">üö´ –û—Ç–∫–∞–∑–∞–ª—Å—è</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'objection', 'invite', '${escBt(personDesc)}', this)">‚ö° –í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ</button>
        </div>
        <div id="obj-row-${recId}" style="display:none">
          <div class="objection-row">
            <input type="text" id="obj-text-${recId}" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ...">
            <button class="btn-save-outcome" onclick="saveOutcome('${recId}', 'invite', '${escBt(personDesc)}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
        <div id="outcome-saved-${recId}"></div>
      </div>
    `;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –í–ö–õ–ê–î–ö–ê 2: –†–ê–°–®–ò–§–†–û–í–ö–ê –¢–†–ï–ö–ï–†–ê
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function analyze() {
    const c1 = document.getElementById('c1').value.trim();
    const c2 = document.getElementById('c2').value.trim();
    const c3 = document.getElementById('c3').value.trim();

    if (uploadedImages.length === 0) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã'); return; }
    if (!c1) { alert('–£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∂–∞–ª–æ–±—É –∫–ª–∏–µ–Ω—Ç–∞'); return; }
    if (!checkTestLimit()) return;

    const stage     = document.querySelector('input[name="stage"]:checked')?.value || 'first_contact';
    const readiness = document.querySelector('input[name="readiness"]:checked')?.value || 'open';

    setDecodeLoading(true);

    try {
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          mode: 'decode',
          images: uploadedImages.map(img => ({ base64: img.base64, mimeType: img.mimeType })),
          complaints: [c1, c2, c3].filter(Boolean),
          stage,
          readiness
        })
      });

      const data = await res.json();
      if (!res.ok || data.error) throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');

      const parsed = parseDecodeResponse(data.result);
      renderDecodeResults(parsed, [c1, c2, c3].filter(Boolean));
      if (isTestMode()) incrementTestCounter();

      // –°–∫—Ä–æ–ª–ª –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º
      if (window.innerWidth < 720) {
        setTimeout(() => {
          document.getElementById('decode-results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 300);
      }

    } catch (err) {
      alert('–û—à–∏–±–∫–∞: ' + err.message);
    } finally {
      setDecodeLoading(false);
    }
  }

  function setDecodeLoading(on) {
    const btn  = document.getElementById('analyze-btn');
    const icon = document.getElementById('btn-icon');
    const text = document.getElementById('btn-text');
    btn.disabled = on;
    if (on) {
      icon.outerHTML = '<div class="spinner" id="btn-icon"></div>';
      text.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...';
    } else {
      document.getElementById('btn-icon').outerHTML = '<span id="btn-icon">üîç</span>';
      text.textContent = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É';
    }
  }

  function parseDecodeResponse(text) {
    const extract = tag => {
      const m = text.match(new RegExp(`<${tag}>[\\s\\S]*?<\\/${tag}>`));
      return m ? m[0].replace(new RegExp(`<\\/?${tag}>`,'g'),'').trim() : '';
    };
    return {
      systems:  extract('—Å–∏—Å—Ç–µ–º—ã'),
      chain:    extract('—Ü–µ–ø–æ—á–∫–∞'),
      protocol: extract('–ø—Ä–æ—Ç–æ–∫–æ–ª'),
      script:   extract('—Å–∫—Ä–∏–ø—Ç'),
      logic:    extract('–ª–æ–≥–∏–∫–∞')
    };
  }

  function renderDecodeResults(data, complaints) {
    const panel = document.getElementById('decode-results');
    const recId = genId();
    const clientDesc = '–ñ–∞–ª–æ–±—ã: ' + complaints.join(', ');

    const cards = [
      { cls: 'card-systems',  icon: 'üìä', title: '–ö–∞—Ä—Ç–∏–Ω–∞ –∑–¥–æ—Ä–æ–≤—å—è',                content: data.systems,  copyable: true },
      { cls: 'card-chain',    icon: 'üîó', title: '–ü—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞',   content: data.chain,    copyable: true },
      { cls: 'card-protocol', icon: 'üíä', title: '–ü—Ä–æ—Ç–æ–∫–æ–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (Coral Club)', content: data.protocol, copyable: true },
      { cls: 'card-script',   icon: 'üí¨', title: '–°–∫—Ä–∏–ø—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏',             content: data.script,   copyable: true },
      { cls: 'card-logic',    icon: 'üí°', title: '–ü–æ—á–µ–º—É —Ç–∞–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª',           content: data.logic,    copyable: false }
    ];

    panel.innerHTML = cards.map((c, i) => `
      <div class="result-card ${c.cls}" style="animation-delay:${i * 0.07}s">
        <div class="result-card-header">
          <div class="card-title">${c.icon} ${c.title}</div>
          ${c.copyable ? `<button class="btn-copy" onclick="copyText(this, \`${escBt(c.content)}\`)">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>` : ''}
        </div>
        <div class="result-card-body">${renderText(c.content || '‚Äî')}</div>
      </div>
    `).join('') + renderDecodeOutcomeBlock(recId, clientDesc);
  }

  function renderDecodeOutcomeBlock(recId, clientDesc) {
    return `
      <div class="outcome-block" id="outcome-${recId}">
        <h3>–ß—Ç–æ –≤ –∏—Ç–æ–≥–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º?</h3>
        <div class="outcome-btns">
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'bought', 'decode', '${escBt(clientDesc)}', this)">‚úÖ –ö—É–ø–∏–ª</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'thinking', 'decode', '${escBt(clientDesc)}', this)">ü§î –î—É–º–∞–µ—Ç</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'rejected', 'decode', '${escBt(clientDesc)}', this)">üö´ –û—Ç–∫–∞–∑–∞–ª—Å—è</button>
          <button class="btn-outcome" onclick="selectOutcome('${recId}', 'objection', 'decode', '${escBt(clientDesc)}', this)">‚ö° –í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ</button>
        </div>
        <div id="obj-row-${recId}" style="display:none">
          <div class="objection-row">
            <input type="text" id="obj-text-${recId}" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞...">
            <button class="btn-save-outcome" onclick="saveOutcome('${recId}', 'decode', '${escBt(clientDesc)}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
        <div id="outcome-saved-${recId}"></div>
      </div>
    `;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –§–ò–ö–°–ê–¶–ò–Ø –ò–°–•–û–î–ê
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  let pendingOutcomes = {}; // recId ‚Üí {type, clientDesc}

  function selectOutcome(recId, outcome, type, clientDesc, btn) {
    // –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫
    btn.closest('.outcome-btns').querySelectorAll('.btn-outcome').forEach(b => {
      b.className = 'btn-outcome';
    });
    btn.classList.add('selected-' + outcome);
    pendingOutcomes[recId] = { outcome, type, clientDesc };

    const objRow = document.getElementById('obj-row-' + recId);
    if (outcome === 'objection') {
      objRow.style.display = 'block';
      document.getElementById('obj-text-' + recId).focus();
    } else {
      objRow.style.display = 'none';
      // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –Ω–µ-–≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π
      const rec = {
        id: recId,
        date: new Date().toISOString(),
        type,
        clientDesc,
        outcome,
        objectionText: ''
      };
      saveRecord(rec);
      document.getElementById('outcome-saved-' + recId).innerHTML =
        '<div class="outcome-saved">‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ</div>';
    }
  }

  function saveOutcome(recId, type, clientDesc) {
    const pending = pendingOutcomes[recId];
    const objText = document.getElementById('obj-text-' + recId)?.value.trim() || '';
    const rec = {
      id: recId,
      date: new Date().toISOString(),
      type,
      clientDesc,
      outcome: pending?.outcome || 'objection',
      objectionText: objText
    };
    saveRecord(rec);
    document.getElementById('obj-row-' + recId).style.display = 'none';
    document.getElementById('outcome-saved-' + recId).innerHTML =
      '<div class="outcome-saved">‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ</div>';
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –í–ö–õ–ê–î–ö–ê 3: –°–¢–ê–¢–ò–°–¢–ò–ö–ê
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  let statsFilter = 'all';

  function renderStats() {
    const records = getRecords();
    const container = document.getElementById('stats-content');

    const total    = records.length;
    const invites  = records.filter(r => r.type === 'invite').length;
    const decodes  = records.filter(r => r.type === 'decode').length;
    const bought   = records.filter(r => r.outcome === 'bought').length;
    const convRate = total ? Math.round(bought / total * 100) : 0;

    // –¢–æ–ø –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π
    const objMap = {};
    records.filter(r => r.outcome === 'objection' && r.objectionText).forEach(r => {
      const key = r.objectionText.trim();
      objMap[key] = (objMap[key] || 0) + 1;
    });
    const topObj = Object.entries(objMap).sort((a,b) => b[1]-a[1]).slice(0, 5);

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø–∏—Å–µ–π
    const filtered = statsFilter === 'all' ? records
      : records.filter(r => r.type === statsFilter);

    const outcomePills = {
      bought:    '<span class="outcome-pill pill-bought">‚úÖ –ö—É–ø–∏–ª</span>',
      thinking:  '<span class="outcome-pill pill-thinking">ü§î –î—É–º–∞–µ—Ç</span>',
      rejected:  '<span class="outcome-pill pill-rejected">üö´ –û—Ç–∫–∞–∑</span>',
      objection: '<span class="outcome-pill pill-objection">‚ö° –í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ</span>',
    };

    const typePills = {
      invite: '<span class="type-pill type-invite">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</span>',
      decode: '<span class="type-pill type-decode">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞</span>'
    };

    container.innerHTML = `
      <div class="stats-summary">
        <div class="stat-card">
          <div class="stat-value">${total}</div>
          <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${bought}</div>
          <div class="stat-label">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${convRate}%</div>
          <div class="stat-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
        </div>
      </div>

      ${topObj.length > 0 ? `
      <div class="stats-section">
        <h3>üî• –¢–æ–ø –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π</h3>
        <ul class="top-objections-list">
          ${topObj.map(([text, cnt]) => `
            <li>
              <span>${text}</span>
              <span class="obj-count">${cnt}</span>
            </li>
          `).join('')}
        </ul>
      </div>
      ` : ''}

      <div class="stats-section">
        <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π</h3>
        <div class="filter-row">
          <button class="btn-filter ${statsFilter==='all'?'active':''}"
            onclick="setFilter('all')">–í—Å–µ (${total})</button>
          <button class="btn-filter ${statsFilter==='invite'?'active':''}"
            onclick="setFilter('invite')">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (${invites})</button>
          <button class="btn-filter ${statsFilter==='decode'?'active':''}"
            onclick="setFilter('decode')">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ (${decodes})</button>
          <button class="btn-export" onclick="exportCSV()">‚¨á –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          ${total > 0 ? `<button class="btn-clear-stats" onclick="clearStats()">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>` : ''}
        </div>

        ${filtered.length === 0 ? `
          <div class="no-records">
            ${total === 0
              ? '–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Ç—ã –æ—Ç–º–µ—Ç–∏—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è.'
              : '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å —Ç–∞–∫–∏–º —Ñ–∏–ª—å—Ç—Ä–æ–º.'}
          </div>
        ` : `
          <table class="records-table">
            <thead>
              <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–¢–∏–ø</th>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–ò—Ç–æ–≥</th>
              </tr>
            </thead>
            <tbody>
              ${filtered.map(r => `
                <tr>
                  <td style="white-space:nowrap;color:#666">${formatDate(r.date)}</td>
                  <td>${typePills[r.type] || r.type}</td>
                  <td style="max-width:200px;color:#aaa">
                    ${escHtml(r.clientDesc || '').substring(0, 80)}${r.clientDesc && r.clientDesc.length > 80 ? '‚Ä¶' : ''}
                  </td>
                  <td>
                    ${outcomePills[r.outcome] || ''}
                    ${r.objectionText ? `<br><span class="objection-tag">${escHtml(r.objectionText)}</span>` : ''}
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `}
      </div>
    `;
  }

  function setFilter(f) {
    statsFilter = f;
    renderStats();
  }

  function clearStats() {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
    localStorage.removeItem('cc_records');
    renderStats();
  }

  function formatDate(iso) {
    const d = new Date(iso);
    const dd   = String(d.getDate()).padStart(2, '0');
    const mm   = String(d.getMonth() + 1).padStart(2, '0');
    const hh   = String(d.getHours()).padStart(2, '0');
    const min  = String(d.getMinutes()).padStart(2, '0');
    return `${dd}.${mm} ${hh}:${min}`;
  }

  function exportCSV() {
    const records = getRecords();
    if (records.length === 0) { alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞'); return; }

    const header = ['–î–∞—Ç–∞', '–¢–∏–ø', '–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞', '–ò—Ç–æ–≥', '–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ'].join(';');
    const rows = records.map(r => [
      new Date(r.date).toLocaleString('ru'),
      r.type === 'invite' ? '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ' : '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞',
      '"' + (r.clientDesc || '').replace(/"/g, '""') + '"',
      r.outcome === 'bought' ? '–ö—É–ø–∏–ª/–°–æ–≥–ª–∞—Å–∏–ª—Å—è' :
      r.outcome === 'thinking' ? '–î—É–º–∞–µ—Ç' :
      r.outcome === 'rejected' ? '–û—Ç–∫–∞–∑' :
      r.outcome === 'objection' ? '–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ' : r.outcome,
      '"' + (r.objectionText || '').replace(/"/g, '""') + '"'
    ].join(';'));

    const csv = '\uFEFF' + header + '\n' + rows.join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url  = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href  = url;
    link.download = 'coral_stats_' + new Date().toISOString().slice(0,10) + '.csv';
    link.click();
    URL.revokeObjectURL(url);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –£–¢–ò–õ–ò–¢–´
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  function renderText(text) {
    return text
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/\[–ü–ï–†–ï–ì–†–£–ó[^\]]*\]/g, m => `<span class="status-red">${m}</span>`)
      .replace(/\[–ù–ê–ì–†–£–ó–ö–ê[^\]]*\]/g, m => `<span class="status-yellow">${m}</span>`)
      .replace(/\[–ù–û–†–ú–ê[^\]]*\]/g,    m => `<span class="status-green">${m}</span>`)
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n/g, '<br>');
  }

  function escBt(str) {
    return (str || '').replace(/\\/g,'\\\\').replace(/`/g,'\\`').replace(/\$/g,'\\$');
  }

  function escHtml(str) {
    return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function copyText(btn, text) {
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
        btn.classList.remove('copied');
      }, 2000);
    });
  }
</script>

</body>
</html>
